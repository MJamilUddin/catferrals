{% comment %}
  Catferrals Social Share Referral
  Social sharing buttons for referral links
  VERSION: catferrals-14-EMERGENCY-REBUILD
{% endcomment %}

<div class="catferrals-social-share-referral" 
     data-shop="{{ shop.permanent_domain }}"
     data-layout="{{ block.settings.layout }}"
     data-size="{{ block.settings.button_size }}"
     data-customer-email="{{ customer.email | default: '' }}"
     data-customer-id="{{ customer.id | default: '' }}"
     data-product-id="{{ product.id | default: '' }}"
     data-page-url="{{ canonical_url }}"
     data-page-title="{{ page_title | default: shop.name }}">
  
  {% comment %} Default content while loading {% endcomment %}
  <div class="catferrals-social-loading" style="text-align: {{ block.settings.alignment }}; padding: 10px;">
    <div style="color: #666; font-size: 14px;">Loading social share...</div>
  </div>
</div>

<script>
(function() {
  'use strict';
  
  // DIAGNOSTIC LOGGING
  console.log('üöÄ CATFERRALS DEBUG: Social Share Widget Script Loading - Version v14-EMERGENCY-REBUILD');
  console.log('üöÄ CATFERRALS DEBUG: Script loaded at:', new Date().toISOString());
  console.log('üöÄ CATFERRALS DEBUG: Current URL:', window.location.href);
  
  // Only initialize once
  if (window.catferralsSocialShareLoaded) {
    console.log('üöÄ CATFERRALS DEBUG: Social Share widget already loaded, skipping initialization');
    return;
  }
  window.catferralsSocialShareLoaded = true;
  console.log('üöÄ CATFERRALS DEBUG: Setting catferralsSocialShareLoaded = true');

  // Initialize social share widget
  function initializeSocialShareWidget(element) {
    console.log('üöÄ CATFERRALS DEBUG: Initializing social share widget for element:', element);
    const layout = element.dataset.layout || 'horizontal';
    const size = element.dataset.size || 'medium';
    const alignment = element.dataset.alignment || 'center';
    console.log('üöÄ CATFERRALS DEBUG: Social share config - layout:', layout, 'size:', size, 'alignment:', alignment);
    
    // Get button sizing
    let buttonSize = 'padding: 8px 12px; font-size: 14px;';
    if (size === 'small') {
      buttonSize = 'padding: 6px 10px; font-size: 12px;';
    } else if (size === 'large') {
      buttonSize = 'padding: 12px 16px; font-size: 16px;';
    }
    
    // Get layout style
    let layoutStyle = 'display: flex; gap: 8px; flex-wrap: wrap;';
    if (layout === 'vertical') {
      layoutStyle = 'display: flex; flex-direction: column; gap: 8px;';
    } else if (layout === 'grid') {
      layoutStyle = 'display: grid; grid-template-columns: 1fr 1fr; gap: 8px;';
    }
    
    // Create widget HTML
    const widgetHTML = `
      <div style="padding: 16px; border-radius: 8px; background: #f8f9fa; border: 1px solid #e9ecef; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; text-align: ${alignment};">
        <div style="margin-bottom: 12px;">
          <span style="font-weight: 600; color: #333;">Share & Earn [DEBUG v14-EMERGENCY-REBUILD]</span>
        </div>
        <div style="${layoutStyle}">
          <button onclick="shareProduct('facebook')" style="${buttonSize} display: flex; align-items: center; gap: 8px; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s; background: white; border: 1px solid #ddd;">
            <span>üìò</span>
            <span>Facebook</span>
          </button>
          <button onclick="shareProduct('twitter')" style="${buttonSize} display: flex; align-items: center; gap: 8px; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s; background: white; border: 1px solid #ddd;">
            <span>üê¶</span>
            <span>Twitter</span>
          </button>
          <button onclick="shareProduct('whatsapp')" style="${buttonSize} display: flex; align-items: center; gap: 8px; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s; background: white; border: 1px solid #ddd;">
            <span>üí¨</span>
            <span>WhatsApp</span>
          </button>
          <button onclick="shareProduct('email')" style="${buttonSize} display: flex; align-items: center; gap: 8px; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s; background: white; border: 1px solid #ddd;">
            <span>üìß</span>
            <span>Email</span>
          </button>
        </div>
      </div>
    `;
    
    element.innerHTML = widgetHTML;
    console.log('üöÄ CATFERRALS DEBUG: Social share widget HTML set successfully');
  }

  // Share product function
  window.shareProduct = function(platform) {
    console.log('üöÄ CATFERRALS DEBUG: Share product function called for platform:', platform);
    const shareUrl = window.location.href;
    const shareText = "Check out this amazing product!";
    
    let shareLink = '';
    switch(platform) {
      case 'facebook':
        shareLink = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
        break;
      case 'twitter':
        shareLink = `https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareText)}`;
        break;
      case 'whatsapp':
        shareLink = `https://wa.me/?text=${encodeURIComponent(shareText + ' ' + shareUrl)}`;
        break;
      case 'email':
        shareLink = `mailto:?subject=${encodeURIComponent('Check out this product!')}&body=${encodeURIComponent(shareText + '\\n\\n' + shareUrl)}`;
        break;
    }
    
    if (shareLink) {
      console.log('üöÄ CATFERRALS DEBUG: Opening share link:', shareLink);
      window.open(shareLink, '_blank', 'width=600,height=400');
    }
  };

  // Initialize all social share widgets on page load
  function initializeAllSocialWidgets() {
    console.log('üöÄ CATFERRALS DEBUG: Starting social share widget initialization');
    const widgets = document.querySelectorAll('.catferrals-social-share-referral');
    console.log('üöÄ CATFERRALS DEBUG: Found', widgets.length, 'social share widgets to initialize');
    widgets.forEach(initializeSocialShareWidget);
    console.log('üöÄ CATFERRALS DEBUG: Social share widget initialization complete');
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    console.log('üöÄ CATFERRALS DEBUG: DOM still loading, adding event listener for social share');
    document.addEventListener('DOMContentLoaded', initializeAllSocialWidgets);
  } else {
    console.log('üöÄ CATFERRALS DEBUG: DOM already loaded, initializing social share immediately');
    initializeAllSocialWidgets();
  }
  
  console.log('üöÄ CATFERRALS DEBUG: Social share script setup complete');
})();
</script>

{% schema %}
{
  "name": "Social Share Referral",
  "target": "section",
  "stylesheet": "referral-social-share.css",
  "settings": [
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "default": "horizontal",
      "options": [
        {
          "value": "horizontal",
          "label": "Horizontal"
        },
        {
          "value": "vertical",
          "label": "Vertical"
        },
        {
          "value": "grid",
          "label": "Grid"
        }
      ]
    },
    {
      "type": "select",
      "id": "button_size",
      "label": "Button Size",
      "default": "medium",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ]
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "Alignment",
      "default": "center",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ]
    },
    {
      "type": "text",
      "id": "share_message",
      "label": "Share Message",
      "default": "Check out this amazing product!"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button Color",
      "default": "#007ace"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ffffff"
    }
  ]
}
{% endschema %} 